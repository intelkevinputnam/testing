<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Step 4: Create a Bootable USB Drive" />
<meta name="DC.coverage" content="" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="step-4-create-a-bootable-usb-drive" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Step 4: Create a Bootable USB Drive</title>
</head>
<body class="no-rel-links" id="step-4-create-a-bootable-usb-drive">

    <h1 class="title topictitle1" id="ariaid-title1">Step 4: Create a Bootable USB Drive</h1>

    <div class="body">
        <div class="div" id="step-4-create-a-bootable-usb-drive__create-bootable-usb"></div>
        <div class="div" id="step-4-create-a-bootable-usb-drive__step-4-create-a-bootable-usb-drive">
            <p class="p">In this step, you will create a bootable USB drive with the Yocto
            Project*-based image on it. Later, you will use the USB drive to install
            the image on the target system.</p>

            <div class="note note"><span class="notetitle">Note:</span> 
                <p class="p">The .wic image must be flashed manually to the target system. To prepare the USB drive, you will flash the .wic image to the USB drive. Then you will add a copy of the image to the same drive. This configuration will enable you to boot the target system from the USB drive and use the copied image to flash the destination drive.</p>

            </div>

            <ol class="ol">
                <li class="li">
                    <p class="p">On the host system, run <code class="ph codeph">df</code> to see the drives:</p>

                    <pre class="pre codeblock"><code>
df -h                    </code></pre>
                    <p class="p">Example output:</p>

                    <img class="image" src="../_images/df_command.png" alt="" />
                </li>

                <li class="li">
                    <p class="p">Insert the USB drive in the host system and wait five seconds.</p>

                </li>

                <li class="li">
                    <p class="p">Run <code class="ph codeph">df</code> again to find out where the USB drive is mounted.</p>

                    <pre class="pre codeblock"><code>
df -h                    </code></pre>
                    <p class="p">Typically the USB drive is mounted on <code class="ph codeph">/media/</code>. Example output with USB
                    drive <code class="ph codeph">/dev/sdc1</code>:</p>

                    <img class="image" src="../_images/df_command_media.png" alt="" />
                </li>

                <li class="li">
                    <p class="p">Run the following command to unmount the USB drive.
                    <strong class="ph b">Replace “sd&lt;letter&gt;&lt;number&gt;” with your USB drive.</strong>
                    In the example above, the drive would be <code class="ph codeph">/dev/sdc1</code>.</p>

                    <pre class="pre codeblock"><code>
sudo umount /dev/sd&lt;letter&gt;&lt;number&gt;                    </code></pre>
                </li>

                <li class="li">
                    <p class="p">Go to the directory where the image is located, see
                    <a class="xref" href="tcc_gsg_build_yocto_image_toolchain.html#build-yocto-image-toolchain">Step 2: Prepare a Yocto Project*-Based Image</a>.</p>

                    <pre class="pre codeblock"><code>
cd &lt;image_directory&gt;                    </code></pre>
                </li>

                <li class="li">
                    <p class="p">Download the latest bmaptool release from
                    <a class="xref" href="https://github.com/intel/bmap-tools/releases" target="_blank">https://github.com/intel/bmap-tools/releases</a>. Bmaptool flashes files to USB, similar to the <code class="ph codeph">dd</code> command.</p>

                    <pre class="pre codeblock"><code>
curl -Lo bmaptool https://github.com/01org/bmap-tools/releases/download/v3.4/bmaptool &amp;&amp; chmod +x bmaptool                    </code></pre>
                </li>

                <li class="li">
                    <p class="p">Ensure that Python* module <code class="ph codeph">six</code> is installed on the system.</p>

                    <pre class="pre codeblock"><code>
pip3 install six                    </code></pre>
                </li>

                <li class="li">
                    <p class="p">Run the following command to generate a bootable USB flash drive.
                    <strong class="ph b">Replace “sd&lt;letter&gt;” with your USB drive.</strong>
                    In the example above, the drive would be <code class="ph codeph">/dev/sdc</code>.
                    <strong class="ph b">This command will replace all existing data on the drive.
                    Make sure it’s the correct drive.</strong></p>

                    <pre class="pre codeblock"><code>
sudo ./bmaptool copy --bmap core-image-sato-sdk-intel-corei7-64-&lt;datetime&gt;.wic.bmap core-image-sato-sdk-intel-corei7-64-&lt;datetime&gt;.wic  /dev/sd&lt;letter&gt;                    </code></pre>
                </li>

                <li class="li">
                    <p class="p">Add a copy of the image file to the USB drive:</p>

                    <ol class="ol" type="a">
                        <li class="li">
                            <p class="p">On the host system, compress the image file for faster copying:</p>

                            <pre class="pre codeblock"><code>
bzip2 -kf core-image-sato-sdk-intel-corei7-64-&lt;datetime&gt;.wic                            </code></pre>
                        </li>

                        <li class="li">
                            <p class="p">Find a partition on the USB drive that is big enough for the
                            compressed image file, for example, the partition named <code class="ph codeph">data</code>.
                            One method of viewing partitions is to use <code class="ph codeph">gparted</code>:</p>

                            <pre class="pre codeblock"><code>
sudo gparted                            </code></pre>
                        </li>

                        <li class="li">
                            <p class="p">On the host system, create the mount point:</p>

                            <pre class="pre codeblock"><code>
sudo mkdir /mnt/usb                            </code></pre>
                        </li>

                        <li class="li">
                            <p class="p">Mount the USB drive. <strong class="ph b">Replace “sd&lt;letter&gt;&lt;number&gt;” with the
                            partition you identified in step 9b.</strong></p>

                            <pre class="pre codeblock"><code>
sudo mount /dev/sd&lt;letter&gt;&lt;number&gt; /mnt/usb                            </code></pre>
                        </li>

                        <li class="li">
                            <p class="p">Copy the compressed image file:</p>

                            <pre class="pre codeblock"><code>
sudo cp &lt;compressed_image_file&gt; /mnt/usb                            </code></pre>
                        </li>

                        <li class="li">
                            <p class="p">Copy the bmap file:</p>

                            <pre class="pre codeblock"><code>
sudo cp core-image-sato-sdk-intel-corei7-64-&lt;datetime&gt;.wic.bmap /mnt/usb                            </code></pre>
                        </li>

                        <li class="li">
                            <p class="p">After copying the compressed image file, unmount the USB drive:</p>

                            <pre class="pre codeblock"><code>
sudo umount /mnt/usb                            </code></pre>
                        </li>

                    </ol>

                </li>

                <li class="li">
                    <p class="p">Remove the USB drive from the host system.</p>

                </li>

            </ol>

        </div>
    </div>

</body>
</html>